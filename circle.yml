machine:
  java:
    version: oraclejdk8
general:
   artifacts:
     - "docs"
database:
  post:
    - mysql -u root --execute "create database if not exists sample character set utf8"
dependencies:
  cache_directories:
    - graphviz-2.38.0
  pre:
    - wget -O graphviz.tar.gz --quiet http://www.graphviz.org/pub/graphviz/ARCHIVE/graphviz-2.38.0.tar.gz
    - tar -zxf graphviz.tar.gz
    - graphviz-2.38.0/configure --silent
    - make --silent --ignore-errors && make --silent --ignore-errors install > /dev/null
    - echo 'which dot && version:'
    - which dot
    - dot -V
  override:
    - mvn dependency:resolve
test:
  pre:
    - mvn flyway:info
  override:
    - mvn flyway:migrate
  post:
    - mvn flyway:info
deployment:
  deploy:
    branch: master
    commands:
      - mvn schemaspy:schemaspy
      - .circleci/deploy.sh
      - mv docs $CIRCLE_ARTIFACTS